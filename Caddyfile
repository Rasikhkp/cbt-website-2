{
    frankenphp
    order php_server before file_server
}

:80 {
    root * /app/public
    php_server
    file_server

    # Handle Laravel pretty URLs
    try_files {path} {path}/ /index.php?{query}

    # Security headers
    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        Referrer-Policy strict-origin-when-cross-origin
        X-XSS-Protection "1; mode=block"
    }

    # Disable access to sensitive files
    @forbidden {
        path /.env*
        path /composer.*
        path /package*.json
        path /.git*
        path /storage/logs/*
        path /artisan
        path /.htaccess
    }
    respond @forbidden 404

    # Enable gzip compression
    encode gzip

    # Cache static assets
    @static {
        path *.css *.js *.ico *.png *.jpg *.jpeg *.gif *.svg *.woff *.woff2
    }
    header @static Cache-Control "public, max-age=31536000"
}
